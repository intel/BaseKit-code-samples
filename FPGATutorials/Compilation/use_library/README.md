# FPGA Tutorial: Use Library

| Optimized for                     | Description
---                                 |---
| OS                                | Linux* Ubuntu* 18.04
| Hardware                          | Intel® Programmable Acceleration Card (PAC) with Intel Arria® 10 GX FPGA
| Software                          | Intel® oneAPI DPC++ Compiler (Beta) 
 
## Purpose
This tutorial demonstrates how to build SYCL* device libraries from various sources and use them in your SYCL* design. 
A library is useful for reusing code or separating code for testing purposes. A library is also useful for providing features from some programming languages that do not exist in other languages.

## Library Generation
You can create a library using the following steps:

1. `fpga_crossgen` creates object file that contains representations for target devices (CPU and FPGA) and FPGA emulator. Currently it can generate object file from *HLS*, *OpenCL*, *RTL*, and *SYCL** source. Here is an example of `fpga_crossgen` creating SYCL* target objects from various sources:
   
   ```
   fpga_crossgen lib_hls.cpp --source hls --target sycl -o lib_hls.o
   fpga_crossgen lib_ocl.cl --source ocl --target sycl -o lib_ocl.o
   fpga_crossgen lib_rtl_spec.xml --emulation_model lib_rtl_model.cpp --target sycl -o lib_rtl.o
   fpga_crossgen lib_sycl.cpp --source sycl --target sycl -o lib_sycl.o
   ```
2. `fpga_libtool` collects one or multiple objects into a SYCL* library archive file. Here is an examples of `fpga_libtool` creating one library archive file from four object files generated by `fpga_crossgen`:

   ```
   fpga_libtool lib_hls.o lib_ocl.o lib_rtl.o lib_sycl.o --target sycl --create lib.a
   ```
## Library Use
To use library, directly add `<library archive file>` to `dpcpp` command.

## Building the `use_library` Tutorial
Perform the following steps:
1. Install the tutorial into the `build` directory from the design directory by running `cmake`:

   ```
   mkdir build
   cd build
   cmake ..
   ```

2. Compile the tutorial design through the generated `Makefile`. The following four targets are provided, matching the recommended development flow:


    * Compile and run for emulation (fast compile time, targets emulated FPGA device) using the following command:

       ```
       make fpga_emu
       ./use_library_emu.fpga 
       ```

    * Generate HTML optimization reports using the following command: 

       ```
       make report
       ``` 
      Locate the report in the `use_library_report.prj/reports/report.html` directory.

    * Compile and run on an FPGA hardware (longer compile time, targets FPGA device) using the following command:

       ```
       make fpga 
       ./use_library.fpga
       ```

    * Compile and run on a CPU hardware (unoptimized) using the following command:

       ```
       make cpu_host
       ./use_library.cpu_host
       ```

(Optional) As the above hardware compile may take several hours to complete, an Intel® PAC with Intel Arria® 10 GX FPGA precompiled binary can be downloaded <a href="https://www.intel.com/content/dam/altera-www/global/en_US/others/support/examples/download/use-library.fpga" download>here</a>.


## Building the `use_library` Tutorial in Third-Party Integrated Development Environments (IDEs)

You can compile and run this tutorial in the Eclipse* IDE (in Linux*). For instructions, refer to the following link: [Intel® oneAPI DPC++ FPGA Workflows on Third-Party IDEs](https://software.intel.com/en-us/articles/intel-oneapi-dpcpp-fpga-workflow-on-ide)
